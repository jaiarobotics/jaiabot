---
- name: Run fleet-config
  hosts: localhost
  gather_facts: no
  vars_files:
    - vars/vfleet_nodes.yml
  tasks:
    - name: Read cloud.env
      include_tasks: tasks/cloud-read-env.yml
      tags: read

    - name: Run fleet-config
      include_tasks: tasks/cloud-run-fleet-config.yml

    - name: Stop instances state
      include_tasks: tasks/cloud-instance-state.yml
      vars: 
        - do_wait: true
        - desired_state: stopped

    - name: Start instances state
      include_tasks: tasks/cloud-instance-state.yml
      vars: 
        - do_wait: true
        - desired_state: started

    - name: Wait for hosts
      include_tasks: tasks/cloud-wait-hosts.yml
